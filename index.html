<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>MindAR App</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- A-Frame and MindAR -->
        <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>

        <style>
            html, body {
                margin: 0;
                padding: 0;
                overflow: hidden;
                width: 100%;
                height: 100%;
            }
            a-scene {
                position: absolute;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
            }
            video, canvas {
                position: absolute;
                top: 0;
                left: 0;
                width: 100% !important;
                height: 100% !important;
                object-fit: cover;
                z-index: -1;
            }
        </style>
    </head>
    <body>
        <a-scene 
            mindar-image="imageTargetSrc: targets.mind; filterMinCF:0.1; filterBeta: 10; warmupTolerance: 1; missTolerance: 1"             embedded 
            color-space="sRGB"
            renderer="colorManagement: true, physicallyCorrectLights"
            vr-mode-ui="enabled: false"
            device-orientation-permission-ui="enabled: false">

            <a-camera position="0 0 0"
                look-controls="enabled: false"
                cursor="rayOrigin: mouse"
                raycaster="objects: .clickable"
            ></a-camera>

            <!-- Tracked AR content -->
            <a-entity mindar-image-target="targetIndex: 0">
                <a-gltf-model
                src="model/duck.glb"
                position="1 0 0"
                scale="2 2 2"
                rotation="0 35 0"
                ></a-gltf-model> 

                <a-box id="tapbox"
                class="clickable"
                color="pink" 
                position="0 0 0.5" 
                scale="1 1 1"
                animation="property: rotation; to: 0 180 0; loop: true; dur: 3000"
                color-changer
                ></a-box>
            </a-entity>
        </a-scene>
        <script>
        // AFRAME component
        AFRAME.registerComponent("color-changer", {
            init: function () {
            this.el.addEventListener("click", () => {
                const color = "#" + Math.floor(Math.random() * 16777215).toString(16).padStart(6, "0");
                this.el.setAttribute("color", color);
                console.log("Box clicked! New color:", color);
            });
            }
        });

        // Fallback manual JS click â€” for testbox only
        window.addEventListener("load", () => {
            const testbox = document.querySelector("#testbox");
            testbox.addEventListener("click", () => {
            console.log("Manual fallback: testbox clicked");
            });
        });
        </script>
    </body>
</html>
